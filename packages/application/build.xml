<?xml version="1.0" encoding="UTF-8"?>
<project name="jellyfish-config" default="build">
    <target name="codeception">
        <exec executable="vendor/bin/codecept">
            <arg value="run"/>
            <arg value="--report"/>
            <arg value="--html"/>
            <arg value="--xml"/>
            <arg value="--coverage"/>
            <arg value="--coverage-html"/>
            <arg value="--coverage-xml"/>
        </exec>
    </target>

    <target name="phpmd">
        <exec executable="vendor/bin/phpmd">
            <arg path="packages/"/>
            <arg value="xml"/>
            <arg value="design,cleancode,codesize"/>
            <arg value="--exclude"/>
            <arg value="EventServiceProvider.php,TransferServiceProvider.php,*Test.php"/>
        </exec>
    </target>

    <target name="phpcs">
        <exec executable="vendor/bin/phpcs">
            <arg value="--standard=PSR12"/>
            <arg path="src/"/>
        </exec>
    </target>

    <target name="phpcpd">
        <exec executable="vendor/bin/phpcpd">
            <arg path="src/"/>
        </exec>
    </target>

    <target name="phpstan">
        <exec executable="vendor/bin/phpstan">
            <arg value="analyse"/>
            <arg value="-c"/>
            <arg value="phpstan.neon"/>
            <arg path="src/"/>
        </exec>
    </target>

    <target name="build">
        <phingcall target="build:analyse"/>
        <phingcall target="build:test"/>
    </target>

    <target name="build:analyse">
        <phingcall target="phpcs"/>
        <phingcall target="phpmd"/>
        <phingcall target="phpcpd"/>
        <phingcall target="phpstan"/>
    </target>

    <target name="build:test">
        <phingcall target="codeception"/>
    </target>
</project>
